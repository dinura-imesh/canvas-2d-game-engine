(()=>{var t={381:()=>{Array.prototype.remove=function(){let t,i,e=arguments,s=e.length;for(;s&&this.length;)for(t=e[--s];-1!==(i=this.indexOf(t));)this.splice(i,1);return this},Array.prototype.removeWhere=function(t){let i=this.length;for(;i--;)t(this[i],i)&&this.splice(i,1)},Number.prototype.toDisplayString=function(){return this.toLocaleString("en-US",{maximumFractionDigits:2})}}},i={};function e(s){var n=i[s];if(void 0!==n)return n.exports;var a=i[s]={exports:{}};return t[s](a,a.exports,e),a.exports}(()=>{"use strict";e(381);class t{loops=[];scenes=[];time={deltaTime:0,time:0,lastLoopTime:0};constructor(){if(t.instance instanceof t)return t.instance;console.log("Engine initialized"),this.initializeEngine(),t.instance=this}initializeEngine(){this.canvas=document.createElement("canvas"),this.updateCanvasSize(),this.context=this.canvas.getContext("2d"),document.body.insertBefore(this.canvas,document.body.childNodes[0]),this.time.lastLoopTime=Date.now(),this.handleClick(),this.gameLoop()}setBackgroundColor=t=>{this.canvas.style.backgroundColor=t};updateCanvasSize=()=>{this.canvas.height=window.innerHeight,window.innerWidth>window.innerHeight?this.canvas.width=window.innerHeight/16*9:this.canvas.width=window.innerWidth,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.ratioX=this.canvasWidth/100,this.ratioY=this.canvasHeight/100};handleClick=()=>{this.canvas.addEventListener("mousedown",(t=>{let i=t.offsetX,e=t.clientY;this.scenes.forEach((t=>t.handleClick(i,e)))}))};addScene=t=>{this.scenes.push(t)};removeScene=t=>{this.scenes.removeWhere((i=>i.tag===t))};gameLoop=()=>{this.clear(),this.handleTime(),this.scenes.forEach((t=>{t.draw(this.context)})),this.loops.forEach((t=>{t()})),requestAnimationFrame(this.gameLoop)};handleTime=()=>{let t=Date.now();this.time.deltaTime=(t-this.time.lastLoopTime)/1e3,this.time.time+=this.time.deltaTime,this.time.lastLoopTime=t};clear=()=>{this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};registerLoop=t=>{this.loops.push(t)};unregisterLoop=t=>{this.loops.remove(t)}}const i=t,s=class{static guid(){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",i="";for(let e=0;e<16;e++)i+=t[Math.floor(Math.random()*t.length)];return i}};class n{constructor(t,i,e,s){this.x=t,this.y=i,this.sizeX=e,this.sizeY=s,this.initialX=this.x,this.initialY=this.y,this.initialSizeX=this.sizeX,this.initialSizeY=this.sizeY}static fromPosition=(t,e)=>new n(t*i.instance.ratioX,e*i.instance.ratioY,1,1);static one=()=>new n(1,1,1,1);static squareSize=(t,e,s)=>new n(t*i.instance.ratioX,e*i.instance.ratioY,s*i.instance.ratioX,s*i.instance.ratioX);static fromAll=t=>new n(t*i.instance.ratioX,t*i.instance.ratioX,t*i.instance.ratioX,t*i.instance.ratioX);static centered=(t,e,s,a)=>new n(t*i.instance.ratioX-s*i.instance.ratioX/2,e*i.instance.ratioY-a*i.instance.ratioY/2,s*i.instance.ratioX,a*i.instance.ratioY);moveX=t=>this.x+=t*i.instance.ratioX;moveY=t=>this.y+=t*i.instance.ratioY;move=(t,e)=>{this.x+=t*i.instance.ratioX,this.y+=e*i.instance.ratioY};setScale(t){this.sizeX=this.initialSizeX*t,this.sizeY=this.initialSizeY*t,this.x=this.initialX+(this.initialSizeX-this.initialSizeX*t)/2,this.y=this.initialY+(this.initialSizeY-this.initialSizeY*t)/2}}const a=n,o=class{constructor(t,i=a.one(),e,n=!0){this.guid=s.guid(),this.visible=n,0===t.length?this.tag=this.guid:this.tag=t,this.transform=i,this.onClick=e}setTag=t=>this.tag=t;initialize(){}setOnClick=t=>{this.onClick=t};draw(t){}loop(){}setVisibility=t=>this.visible=t},h=class{fontType="normal";font="Poppins";fontSize=50*i.instance.ratioX;fillStyle="black";textAlign="left";lineHeight=2*i.instance.ratioY;maxWidth=1e3;getFont=()=>`${this.fontType} ${this.fontSize}px ${this.font}`;setFont=t=>(this.font=t,this);setFillStyle=t=>(this.fillStyle=t,this);setTextAlign=t=>(this.textAlign=t,this);setFontSize=t=>(this.fontSize=t*i.instance.ratioX,this);setFontType=t=>(this.fontType=t,this);setLineHeight=t=>(this.lineHeight=t*i.instance.ratioY,this);setMaxWidth=t=>(this.maxWidth=t*i.instance.ratioX,this)},r=class extends o{constructor(t,{style:i=new h,transform:e=a.one(),tag:s="",onClick:n}){super(s,e,n),this.text=t,this.style=i}draw(t){t.font=this.style.getFont(),t.fillStyle=this.style.fillStyle,t.textAlign=this.style.textAlign;let e=this.text.split(" "),s="",n=this.transform.y;for(let a=0;a<e.length;a++){let o=s+e[a]+" ";t.measureText(o).width>this.style.maxWidth&&a>0?(t.fillText(s,this.transform.x,n-1.4*i.instance.ratioY),s=e[a]+" ",n+=this.style.lineHeight):s=o}t.fillText(s,this.transform.x,n)}setText(t){this.text=t}},l=class{static getImage(t){let i=new Image;return i.src=t,i}},c=new i;let g=0;const m=new class{components=[];constructor(t,{backgroundColor:e="#fff",tag:n="",visible:a=!0}){this.guid=s.guid(),this.components=t,0===n.length?this.tag=this.guid:this.tag=n,i.instance.setBackgroundColor(e),this.isVisible=a}draw=t=>{this.isVisible&&this.components.forEach((i=>{i.visible&&i.draw(t),i.loop()}))};handleClick=(t,i)=>{this.isVisible&&this.components.forEach((e=>{null!=e.onClick&&t>=e.transform.x&&t<=e.transform.x+e.transform.sizeX&&i>=e.transform.y&&i<=e.transform.y+e.transform.sizeY&&e.onClick()}))};setVisibility=t=>this.isVisible=t;removeScene=()=>(new i).removeScene(this.tag);findComponentByTag=t=>this.components.find((i=>i.tag===t))}([new r("Hello",{style:(new h).setFontSize(8).setFillStyle("#098aa0").setTextAlign("center"),transform:a.fromPosition(50,10)}),new r(`Count ${g}`,{style:(new h).setFontSize(8).setFillStyle("#098aa0").setTextAlign("center"),transform:a.fromPosition(50,50),tag:"counter"}),new class extends o{constructor(t,{transform:i=a.one(),tag:e="",onClick:s}){super(e,i,s),this.image=l.getImage(t)}draw=t=>{t.drawImage(this.image,this.transform.x,this.transform.y,this.transform.sizeX,this.transform.sizeY)};setImage=t=>{this.image=l.getImage(t)}}("./images/btn.png",{transform:a.centered(50,85,50,10),tag:"button"})],{backgroundColor:"#fff",tag:"sample_scene"});new class{elapsed=0;value=0;constructor(t,i,e,s,n,{loop:a=!1}){this.tweeningTransform=t,this.type=i,this.duration=e,this.loop=a,this.initialValue=s,this.targetValue=n,"scale"===this.type&&(this.tweeningFunction=this.scale)}start=()=>(i.instance.registerLoop(this.tween),this);stop=()=>(i.instance.unregisterLoop(this.tween),this);tween=()=>{if(this.elapsed<this.duration)this.tweeningFunction(),this.elapsed+=i.instance.time.deltaTime;else if(this.loop){this.elapsed=0;let t=this.initialValue;this.initialValue=this.targetValue,this.targetValue=t}else this.stop()};scale=()=>{let t=this.elapsed/this.duration,i=(this.targetValue-this.initialValue)*t+this.initialValue;this.tweeningTransform.setScale(i)}}(m.findComponentByTag("button").transform,"scale",.5,1,1.05,{loop:!0}).start(),m.findComponentByTag("button").setOnClick((()=>{g+=1,m.findComponentByTag("counter").setText(`Count ${g}`)})),c.addScene(m)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9odG1sLWdhbWUtZW5naW5lLy4vZW5naW5lL3V0aWxzL2V4dGVuc2lvbnMuanMiLCJ3ZWJwYWNrOi8vaHRtbC1nYW1lLWVuZ2luZS93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9odG1sLWdhbWUtZW5naW5lLy4vZW5naW5lL2NvcmUvRW5naW5lLmpzIiwid2VicGFjazovL2h0bWwtZ2FtZS1lbmdpbmUvLi9lbmdpbmUvdXRpbHMvSWRHZW5lcmF0b3IuanMiLCJ3ZWJwYWNrOi8vaHRtbC1nYW1lLWVuZ2luZS8uL2VuZ2luZS9jb3JlL1RyYW5zZm9ybS5qcyIsIndlYnBhY2s6Ly9odG1sLWdhbWUtZW5naW5lLy4vZW5naW5lL2NvcmUvQmFzZUNvbXBvbmVudC5qcyIsIndlYnBhY2s6Ly9odG1sLWdhbWUtZW5naW5lLy4vZW5naW5lL2NvbmZpZ3MvVGV4dFN0eWxlLmpzIiwid2VicGFjazovL2h0bWwtZ2FtZS1lbmdpbmUvLi9lbmdpbmUvY29tcG9uZW50cy9UZXh0Q29tcG9uZW50LmpzIiwid2VicGFjazovL2h0bWwtZ2FtZS1lbmdpbmUvLi9lbmdpbmUvdXRpbHMvRWxlbWVudFByb3ZpZGVyLmpzIiwid2VicGFjazovL2h0bWwtZ2FtZS1lbmdpbmUvLi9zYW1wbGUtZ2FtZS9nYW1lLmpzIiwid2VicGFjazovL2h0bWwtZ2FtZS1lbmdpbmUvLi9lbmdpbmUvY29yZS9TY2VuZS5qcyIsIndlYnBhY2s6Ly9odG1sLWdhbWUtZW5naW5lLy4vZW5naW5lL2NvbXBvbmVudHMvSW1hZ2VDb21wb25lbnQuanMiLCJ3ZWJwYWNrOi8vaHRtbC1nYW1lLWVuZ2luZS8uL2VuZ2luZS9jb3JlL1R3ZWVuLmpzIl0sIm5hbWVzIjpbIkFycmF5IiwicHJvdG90eXBlIiwicmVtb3ZlIiwid2hhdCIsImF4IiwiYSIsImFyZ3VtZW50cyIsIkwiLCJsZW5ndGgiLCJ0aGlzIiwiaW5kZXhPZiIsInNwbGljZSIsInJlbW92ZVdoZXJlIiwiY2FsbGJhY2siLCJpIiwiTnVtYmVyIiwidG9EaXNwbGF5U3RyaW5nIiwidG9Mb2NhbGVTdHJpbmciLCJtYXhpbXVtRnJhY3Rpb25EaWdpdHMiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIkVuZ2luZSIsImxvb3BzIiwic2NlbmVzIiwidGltZSIsImRlbHRhVGltZSIsImxhc3RMb29wVGltZSIsImNvbnN0cnVjdG9yIiwiaW5zdGFuY2UiLCJjb25zb2xlIiwibG9nIiwiaW5pdGlhbGl6ZUVuZ2luZSIsImNhbnZhcyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInVwZGF0ZUNhbnZhc1NpemUiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImJvZHkiLCJpbnNlcnRCZWZvcmUiLCJjaGlsZE5vZGVzIiwiRGF0ZSIsIm5vdyIsImhhbmRsZUNsaWNrIiwiZ2FtZUxvb3AiLCJzZXRCYWNrZ3JvdW5kQ29sb3IiLCJjb2xvciIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiaGVpZ2h0Iiwid2luZG93IiwiaW5uZXJIZWlnaHQiLCJpbm5lcldpZHRoIiwid2lkdGgiLCJjYW52YXNXaWR0aCIsImNhbnZhc0hlaWdodCIsInJhdGlvWCIsInJhdGlvWSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldiIsIngiLCJvZmZzZXRYIiwieSIsImNsaWVudFkiLCJmb3JFYWNoIiwiZSIsImFkZFNjZW5lIiwic2NlbmUiLCJwdXNoIiwicmVtb3ZlU2NlbmUiLCJ0YWciLCJjbGVhciIsImhhbmRsZVRpbWUiLCJkcmF3IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2xlYXJSZWN0IiwicmVnaXN0ZXJMb29wIiwiZnVuYyIsInVucmVnaXN0ZXJMb29wIiwibGV0dGVycyIsImlkIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiVHJhbnNmb3JtIiwic2l6ZVgiLCJzaXplWSIsImluaXRpYWxYIiwiaW5pdGlhbFkiLCJpbml0aWFsU2l6ZVgiLCJpbml0aWFsU2l6ZVkiLCJzaXplIiwibW92ZVgiLCJ2YWwiLCJtb3ZlWSIsIm1vdmUiLCJzZXRTY2FsZSIsInNjYWxlIiwidHJhbnNmb3JtIiwib25DbGljayIsInZpc2libGUiLCJndWlkIiwic2V0VGFnIiwiaW5pdGlhbGl6ZSIsInNldE9uQ2xpY2siLCJvbkNsaWNrRnVuYyIsImN0eCIsImxvb3AiLCJzZXRWaXNpYmlsaXR5IiwiaXNWaXNpYmxlIiwiZm9udFR5cGUiLCJmb250IiwiZm9udFNpemUiLCJmaWxsU3R5bGUiLCJ0ZXh0QWxpZ24iLCJsaW5lSGVpZ2h0IiwibWF4V2lkdGgiLCJnZXRGb250Iiwic2V0Rm9udCIsInNldEZpbGxTdHlsZSIsInNldFRleHRBbGlnbiIsImFsaWduIiwic2V0Rm9udFNpemUiLCJzZXRGb250VHlwZSIsInNldExpbmVIZWlnaHQiLCJzZXRNYXhXaWR0aCIsInRleHQiLCJzdXBlciIsIndvcmRzIiwic3BsaXQiLCJsaW5lIiwibiIsInRlc3RMaW5lIiwibWVhc3VyZVRleHQiLCJmaWxsVGV4dCIsInNldFRleHQiLCJ1cmwiLCJpbWciLCJJbWFnZSIsInNyYyIsImVuZ2luZSIsImNvdW50Iiwic2FtcGxlU2NlbmUiLCJjb21wb25lbnRzIiwiZmluZENvbXBvbmVudEJ5VGFnIiwiZmluZCIsImltYWdlVXJsIiwiaW1hZ2UiLCJkcmF3SW1hZ2UiLCJzZXRJbWFnZSIsImVsYXBzZWQiLCJ2YWx1ZSIsInR5cGUiLCJkdXJhdGlvbiIsImluaXRpYWxWYWx1ZSIsInRhcmdldFZhbHVlIiwidHdlZW5pbmdUcmFuc2Zvcm0iLCJ0d2VlbmluZ0Z1bmN0aW9uIiwic3RhcnQiLCJ0d2VlbiIsInN0b3AiLCJ0ZW1wIiwicGVyY2VudGFnZSIsImN1cnIiXSwibWFwcGluZ3MiOiJzQkFBQUEsTUFBTUMsVUFBVUMsT0FBUyxXQUNyQixJQUFJQyxFQUFtQ0MsRUFBN0JDLEVBQUlDLFVBQVdDLEVBQUlGLEVB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Q1p4RyxLQUFLdUosYUFBZUEsRUFDcEJ2SixLQUFLd0osWUFBY0EsRUFDRCxVQUFkeEosS0FBS3FKLE9BQ0xySixLQUFLMEosaUJBQW1CMUosS0FBSzhGLE9BR3JDNkQsTUFBUSxLQUNKLHdCQUE2QjNKLEtBQUs0SixPQUMzQjVKLE1BR1g2SixLQUFPLEtBQ0gsMEJBQStCN0osS0FBSzRKLE9BQzdCNUosTUFHWDRKLE1BQVEsS0FDSixHQUFJNUosS0FBS21KLFFBQVVuSixLQUFLc0osU0FDcEJ0SixLQUFLMEosbUJBQ0wxSixLQUFLbUosU0FBVywrQkFFaEIsR0FBSW5KLEtBQUt3RyxLQUFNLENBQ1h4RyxLQUFLbUosUUFBVSxFQUNmLElBQUlXLEVBQU85SixLQUFLdUosYUFDaEJ2SixLQUFLdUosYUFBZXZKLEtBQUt3SixZQUN6QnhKLEtBQUt3SixZQUFjTSxPQUVuQjlKLEtBQUs2SixRQUtqQi9ELE1BQVEsS0FDSixJQUFJaUUsRUFBYS9KLEtBQUttSixRQUFVbkosS0FBS3NKLFNBQ2pDVSxHQUFTaEssS0FBS3dKLFlBQWN4SixLQUFLdUosY0FBZ0JRLEVBQWMvSixLQUFLdUosYUFDeEV2SixLQUFLeUosa0JBQWtCNUQsU0FBU21FLEtIcEI5QnJCLEVBQVlFLG1CQUFtQixVQUFVOUMsVUFBVyxRQUFTLEdBQUssRUFBRyxLQUFNLENBQUNTLE1BQU0sSUFBT21ELFFBRW5HaEIsRUFBWUUsbUJBQW1CLFVBQVV4QyxZQUFXLEtBQ2hEcUMsR0FBUyxFQUNUQyxFQUFZRSxtQkFBbUIsV0FBV1QsUUFBUSxTQUFTTSxRQUkvREQsRUFBTzFFLFNBQVM0RSxJIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJBcnJheS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgbGV0IHdoYXQsIGEgPSBhcmd1bWVudHMsIEwgPSBhLmxlbmd0aCwgYXg7XHJcbiAgICB3aGlsZSAoTCAmJiB0aGlzLmxlbmd0aCkge1xyXG4gICAgICAgIHdoYXQgPSBhWy0tTF07XHJcbiAgICAgICAgd2hpbGUgKChheCA9IHRoaXMuaW5kZXhPZih3aGF0KSkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3BsaWNlKGF4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbkFycmF5LnByb3RvdHlwZS5yZW1vdmVXaGVyZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG4gICAgbGV0IGkgPSB0aGlzLmxlbmd0aDtcclxuICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2sodGhpc1tpXSwgaSkpIHtcclxuICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuTnVtYmVyLnByb3RvdHlwZS50b0Rpc3BsYXlTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy50b0xvY2FsZVN0cmluZygnZW4tVVMnLCB7bWF4aW11bUZyYWN0aW9uRGlnaXRzOiAyfSk7XHJcbn07XHJcblxyXG5cclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsImltcG9ydCAnLi4vdXRpbHMvZXh0ZW5zaW9ucydcclxuXHJcbmNsYXNzIEVuZ2luZSB7XHJcbiAgICBsb29wcyA9IFtdO1xyXG4gICAgc2NlbmVzID0gW107XHJcbiAgICB0aW1lID0ge1xyXG4gICAgICAgIGRlbHRhVGltZTogMCxcclxuICAgICAgICB0aW1lOiAwLFxyXG4gICAgICAgIGxhc3RMb29wVGltZTogMCxcclxuICAgIH1cclxuXHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgaWYgKEVuZ2luZS5pbnN0YW5jZSBpbnN0YW5jZW9mIEVuZ2luZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gRW5naW5lLmluc3RhbmNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRW5naW5lIGluaXRpYWxpemVkXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVFbmdpbmUoKTtcclxuICAgICAgICAgICAgRW5naW5lLmluc3RhbmNlID0gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaW5pdGlhbGl6ZUVuZ2luZSgpIHtcclxuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlQ2FudmFzU2l6ZSgpO1xyXG4gICAgICAgIHRoaXMuY29udGV4dCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEJlZm9yZSh0aGlzLmNhbnZhcywgZG9jdW1lbnQuYm9keS5jaGlsZE5vZGVzWzBdKTtcclxuICAgICAgICB0aGlzLnRpbWUubGFzdExvb3BUaW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB0aGlzLmhhbmRsZUNsaWNrKClcclxuICAgICAgICB0aGlzLmdhbWVMb29wKCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0QmFja2dyb3VuZENvbG9yID0gKGNvbG9yKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVDYW52YXNTaXplID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcclxuICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiB3aW5kb3cuaW5uZXJIZWlnaHQpXHJcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVySGVpZ2h0IC8gMTYgKiA5O1xyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICB0aGlzLmNhbnZhc1dpZHRoID0gdGhpcy5jYW52YXMud2lkdGg7XHJcbiAgICAgICAgdGhpcy5jYW52YXNIZWlnaHQgPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XHJcbiAgICAgICAgdGhpcy5yYXRpb1ggPSB0aGlzLmNhbnZhc1dpZHRoIC8gMTAwO1xyXG4gICAgICAgIHRoaXMucmF0aW9ZID0gdGhpcy5jYW52YXNIZWlnaHQgLyAxMDA7XHJcbiAgICB9XHJcblxyXG4gICAgaGFuZGxlQ2xpY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGV2KSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB4ID0gZXYub2Zmc2V0WDtcclxuICAgICAgICAgICAgbGV0IHkgPSBldi5jbGllbnRZO1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lcy5mb3JFYWNoKGUgPT4gZS5oYW5kbGVDbGljayh4LCB5KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWRkU2NlbmUgPSAoc2NlbmUpID0+IHtcclxuICAgICAgICB0aGlzLnNjZW5lcy5wdXNoKHNjZW5lKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVTY2VuZSA9ICh0YWcpID0+IHtcclxuICAgICAgICB0aGlzLnNjZW5lcy5yZW1vdmVXaGVyZShlID0+IGUudGFnID09PSB0YWcpO1xyXG4gICAgfVxyXG5cclxuICAgIGdhbWVMb29wID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuY2xlYXIoKTtcclxuICAgICAgICB0aGlzLmhhbmRsZVRpbWUoKTtcclxuICAgICAgICB0aGlzLnNjZW5lcy5mb3JFYWNoKGUgPT4ge1xyXG4gICAgICAgICAgICBlLmRyYXcodGhpcy5jb250ZXh0KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmxvb3BzLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgIGUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5nYW1lTG9vcClcclxuICAgIH1cclxuXHJcbiAgICBoYW5kbGVUaW1lID0gKCkgPT4ge1xyXG4gICAgICAgIGxldCBub3cgPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIHRoaXMudGltZS5kZWx0YVRpbWUgPSAobm93IC0gdGhpcy50aW1lLmxhc3RMb29wVGltZSkgLyAxMDAwO1xyXG4gICAgICAgIHRoaXMudGltZS50aW1lICs9IHRoaXMudGltZS5kZWx0YVRpbWU7XHJcbiAgICAgICAgdGhpcy50aW1lLmxhc3RMb29wVGltZSA9IG5vdztcclxuICAgIH1cclxuXHJcbiAgICBjbGVhciA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lzdGVyTG9vcCA9IChmdW5jKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb29wcy5wdXNoKGZ1bmMpO1xyXG4gICAgfVxyXG5cclxuICAgIHVucmVnaXN0ZXJMb29wID0gKGZ1bmMpID0+IHtcclxuICAgICAgICB0aGlzLmxvb3BzLnJlbW92ZShmdW5jKTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgRW5naW5lO1xyXG4iLCJjbGFzcyBJZEdlbmVyYXRvciB7XHJcbiAgICBzdGF0aWMgZ3VpZCgpIHtcclxuICAgICAgICBsZXQgbGV0dGVycyA9ICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaMTIzNDU2Nzg5MCc7XHJcbiAgICAgICAgbGV0IGlkID0gXCJcIjtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHtcclxuICAgICAgICAgICAgaWQgKz0gbGV0dGVyc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBsZXR0ZXJzLmxlbmd0aCldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaWQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IElkR2VuZXJhdG9yO1xyXG4iLCJpbXBvcnQgRW5naW5lIGZyb20gXCIuL0VuZ2luZVwiO1xyXG5cclxuY2xhc3MgVHJhbnNmb3JtIHtcclxuICAgIGNvbnN0cnVjdG9yKHgsIHksIHNpemVYLCBzaXplWSkge1xyXG4gICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICB0aGlzLnNpemVYID0gc2l6ZVg7XHJcbiAgICAgICAgdGhpcy5zaXplWSA9IHNpemVZO1xyXG4gICAgICAgIHRoaXMuaW5pdGlhbFggPSB0aGlzLng7XHJcbiAgICAgICAgdGhpcy5pbml0aWFsWSA9IHRoaXMueTtcclxuICAgICAgICB0aGlzLmluaXRpYWxTaXplWCA9IHRoaXMuc2l6ZVg7XHJcbiAgICAgICAgdGhpcy5pbml0aWFsU2l6ZVkgPSB0aGlzLnNpemVZO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBmcm9tUG9zaXRpb24gPSAoeCwgeSkgPT4gbmV3IFRyYW5zZm9ybSh4ICogRW5naW5lLmluc3RhbmNlLnJhdGlvWCAsIHkgKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9ZLCAxICwgMSlcclxuXHJcbiAgICBzdGF0aWMgb25lID0gKCkgPT4gbmV3IFRyYW5zZm9ybSgxLCAxLCAxLCAxKVxyXG5cclxuICAgIHN0YXRpYyBzcXVhcmVTaXplID0gKHgsIHksIHNpemUpID0+IG5ldyBUcmFuc2Zvcm0oeCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1gsIHkgKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9ZLCBzaXplICogRW5naW5lLmluc3RhbmNlLnJhdGlvWCwgc2l6ZSAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1gpO1xyXG5cclxuICAgIHN0YXRpYyBmcm9tQWxsID0gKGEpID0+IG5ldyBUcmFuc2Zvcm0oYSAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1gsIGEgKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9YLCBhICogRW5naW5lLmluc3RhbmNlLnJhdGlvWCwgYSAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1gpO1xyXG5cclxuICAgIHN0YXRpYyBjZW50ZXJlZCA9ICh4LCB5LCBzaXplWCwgc2l6ZVkpID0+IG5ldyBUcmFuc2Zvcm0oeCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1ggLSAoc2l6ZVggKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9YIC8gMiksIHkgKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9ZIC0gKHNpemVZICogRW5naW5lLmluc3RhbmNlLnJhdGlvWSAvIDIpLCBzaXplWCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1gsIHNpemVZICogRW5naW5lLmluc3RhbmNlLnJhdGlvWSk7XHJcblxyXG5cclxuICAgIG1vdmVYID0gKHZhbCkgPT4gdGhpcy54ICs9IHZhbCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1g7XHJcblxyXG4gICAgbW92ZVkgPSAodmFsKSA9PiB0aGlzLnkgKz0gdmFsICogRW5naW5lLmluc3RhbmNlLnJhdGlvWTtcclxuXHJcbiAgICBtb3ZlID0gKHgsIHkpID0+IHtcclxuICAgICAgICB0aGlzLnggKz0geCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1g7XHJcbiAgICAgICAgdGhpcy55ICs9IHkgKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9ZO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFNjYWxlKHNjYWxlKSB7XHJcbiAgICAgICAgdGhpcy5zaXplWCA9IHRoaXMuaW5pdGlhbFNpemVYICogc2NhbGU7XHJcbiAgICAgICAgdGhpcy5zaXplWSA9IHRoaXMuaW5pdGlhbFNpemVZICogc2NhbGU7XHJcbiAgICAgICAgdGhpcy54ID0gdGhpcy5pbml0aWFsWCArICgodGhpcy5pbml0aWFsU2l6ZVggLSAodGhpcy5pbml0aWFsU2l6ZVggKiBzY2FsZSkpIC8gMik7XHJcbiAgICAgICAgdGhpcy55ID0gdGhpcy5pbml0aWFsWSArICgodGhpcy5pbml0aWFsU2l6ZVkgLSAodGhpcy5pbml0aWFsU2l6ZVkgKiBzY2FsZSkpIC8gMik7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBUcmFuc2Zvcm07XHJcbiIsImltcG9ydCBJZEdlbmVyYXRvciBmcm9tIFwiLi4vdXRpbHMvSWRHZW5lcmF0b3JcIjtcclxuaW1wb3J0IFRyYW5zZm9ybSBmcm9tIFwiLi9UcmFuc2Zvcm1cIjtcclxuXHJcbmNsYXNzIEJhc2VDb21wb25lbnQge1xyXG4gICAgY29uc3RydWN0b3IodGFnLCB0cmFuc2Zvcm0gPSBUcmFuc2Zvcm0ub25lKCksIG9uQ2xpY2ssIHZpc2libGUgPSB0cnVlKSB7XHJcbiAgICAgICAgdGhpcy5ndWlkID0gSWRHZW5lcmF0b3IuZ3VpZCgpO1xyXG4gICAgICAgIHRoaXMudmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICAgICAgdGFnLmxlbmd0aCA9PT0gMCA/IHRoaXMudGFnID0gdGhpcy5ndWlkIDogdGhpcy50YWcgPSB0YWc7XHJcbiAgICAgICAgdGhpcy50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XHJcbiAgICAgICAgdGhpcy5vbkNsaWNrID0gb25DbGljaztcclxuICAgIH1cclxuXHJcbiAgICBzZXRUYWcgPSAodGFnKSA9PiB0aGlzLnRhZyA9IHRhZztcclxuXHJcbiAgICBpbml0aWFsaXplKCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBzZXRPbkNsaWNrID0gKG9uQ2xpY2tGdW5jKSA9PiB7XHJcbiAgICAgICAgdGhpcy5vbkNsaWNrID0gb25DbGlja0Z1bmM7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhdyhjdHgpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgbG9vcCgpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2V0VmlzaWJpbGl0eSA9IChpc1Zpc2libGUpID0+IHRoaXMudmlzaWJsZSA9IGlzVmlzaWJsZTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgQmFzZUNvbXBvbmVudDtcclxuIiwiaW1wb3J0IEVuZ2luZSBmcm9tIFwiLi4vY29yZS9FbmdpbmVcIjtcclxuXHJcbmNsYXNzIFRleHRTdHlsZSB7XHJcbiAgICBmb250VHlwZSA9IFwibm9ybWFsXCI7XHJcbiAgICBmb250ID0gJ1BvcHBpbnMnO1xyXG4gICAgZm9udFNpemUgPSA1MCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1g7XHJcbiAgICBmaWxsU3R5bGUgPSAnYmxhY2snO1xyXG4gICAgdGV4dEFsaWduID0gJ2xlZnQnO1xyXG4gICAgbGluZUhlaWdodCA9IDIgKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9ZO1xyXG4gICAgbWF4V2lkdGggPSAxMDAwO1xyXG5cclxuICAgIGdldEZvbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuZm9udFR5cGV9ICR7dGhpcy5mb250U2l6ZX1weCAke3RoaXMuZm9udH1gO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEZvbnQgPSBmb250ID0+IHtcclxuICAgICAgICB0aGlzLmZvbnQgPSBmb250O1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEZpbGxTdHlsZSA9IHN0eWxlID0+IHtcclxuICAgICAgICB0aGlzLmZpbGxTdHlsZSA9IHN0eWxlO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRleHRBbGlnbiA9IGFsaWduID0+IHtcclxuICAgICAgICB0aGlzLnRleHRBbGlnbiA9IGFsaWduO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEZvbnRTaXplID0gZm9udFNpemUgPT4ge1xyXG4gICAgICAgIHRoaXMuZm9udFNpemUgPSBmb250U2l6ZSAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1g7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Rm9udFR5cGUgPSAoZm9udFR5cGUpID0+IHtcclxuICAgICAgICB0aGlzLmZvbnRUeXBlID0gZm9udFR5cGU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TGluZUhlaWdodCA9IChsaW5lSGVpZ2h0KSA9PiB7XHJcbiAgICAgICAgdGhpcy5saW5lSGVpZ2h0ID0gbGluZUhlaWdodCAqIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1k7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TWF4V2lkdGggPSAod2lkdGgpID0+IHtcclxuICAgICAgICB0aGlzLm1heFdpZHRoID0gd2lkdGggKiBFbmdpbmUuaW5zdGFuY2UucmF0aW9YO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBUZXh0U3R5bGU7XHJcbiIsImltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuLi9jb3JlL0Jhc2VDb21wb25lbnRcIjtcclxuaW1wb3J0IFRyYW5zZm9ybSBmcm9tIFwiLi4vY29yZS9UcmFuc2Zvcm1cIjtcclxuaW1wb3J0IFRleHRTdHlsZSBmcm9tIFwiLi4vY29uZmlncy9UZXh0U3R5bGVcIjtcclxuaW1wb3J0IEVuZ2luZSBmcm9tIFwiLi4vY29yZS9FbmdpbmVcIjtcclxuXHJcbmNsYXNzIFRleHRDb21wb25lbnQgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKHRleHQsIHtzdHlsZSA9IG5ldyBUZXh0U3R5bGUoKSwgdHJhbnNmb3JtID0gVHJhbnNmb3JtLm9uZSgpLCB0YWcgPSAnJywgb25DbGlja30pIHtcclxuICAgICAgICBzdXBlcih0YWcsIHRyYW5zZm9ybSwgb25DbGljayk7XHJcbiAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDtcclxuICAgICAgICB0aGlzLnN0eWxlID0gc3R5bGU7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhdyhjdHgpIHtcclxuICAgICAgICBjdHguZm9udCA9IHRoaXMuc3R5bGUuZ2V0Rm9udCgpO1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLnN0eWxlLmZpbGxTdHlsZTtcclxuICAgICAgICBjdHgudGV4dEFsaWduID0gdGhpcy5zdHlsZS50ZXh0QWxpZ247XHJcbiAgICAgICAgbGV0IHdvcmRzID0gdGhpcy50ZXh0LnNwbGl0KCcgJyk7XHJcbiAgICAgICAgbGV0IGxpbmUgPSAnJztcclxuICAgICAgICBsZXQgeSA9IHRoaXMudHJhbnNmb3JtLnk7XHJcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCB3b3Jkcy5sZW5ndGg7IG4rKykge1xyXG4gICAgICAgICAgICBsZXQgdGVzdExpbmUgPSBsaW5lICsgd29yZHNbbl0gKyAnICc7XHJcbiAgICAgICAgICAgIGxldCBtZXRyaWNzID0gY3R4Lm1lYXN1cmVUZXh0KHRlc3RMaW5lKTtcclxuICAgICAgICAgICAgbGV0IHRlc3RXaWR0aCA9IG1ldHJpY3Mud2lkdGg7XHJcbiAgICAgICAgICAgIGlmICh0ZXN0V2lkdGggPiB0aGlzLnN0eWxlLm1heFdpZHRoICYmIG4gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQobGluZSwgdGhpcy50cmFuc2Zvcm0ueCwgeSAtIEVuZ2luZS5pbnN0YW5jZS5yYXRpb1kgKiAxLjQpO1xyXG4gICAgICAgICAgICAgICAgbGluZSA9IHdvcmRzW25dICsgJyAnO1xyXG4gICAgICAgICAgICAgICAgeSArPSB0aGlzLnN0eWxlLmxpbmVIZWlnaHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsaW5lID0gdGVzdExpbmU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY3R4LmZpbGxUZXh0KGxpbmUsIHRoaXMudHJhbnNmb3JtLngsIHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldFRleHQodGV4dCkge1xyXG4gICAgICAgIHRoaXMudGV4dCA9IHRleHQ7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBUZXh0Q29tcG9uZW50O1xyXG4iLCJjbGFzcyBFbGVtZW50UHJvdmlkZXIge1xyXG4gICAgc3RhdGljIGdldEltYWdlKHVybCkge1xyXG4gICAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICBpbWcuc3JjID0gdXJsO1xyXG4gICAgICAgIHJldHVybiBpbWc7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IEVsZW1lbnRQcm92aWRlcjtcclxuIiwiaW1wb3J0IEVuZ2luZSBmcm9tIFwiLi4vZW5naW5lL2NvcmUvRW5naW5lXCI7XG5pbXBvcnQgVGV4dENvbXBvbmVudCBmcm9tIFwiLi4vZW5naW5lL2NvbXBvbmVudHMvVGV4dENvbXBvbmVudFwiO1xuaW1wb3J0IFRleHRTdHlsZSBmcm9tIFwiLi4vZW5naW5lL2NvbmZpZ3MvVGV4dFN0eWxlXCI7XG5pbXBvcnQgVHJhbnNmb3JtIGZyb20gXCIuLi9lbmdpbmUvY29yZS9UcmFuc2Zvcm1cIjtcbmltcG9ydCBTY2VuZSBmcm9tIFwiLi4vZW5naW5lL2NvcmUvU2NlbmVcIjtcbmltcG9ydCBJbWFnZUNvbXBvbmVudCBmcm9tIFwiLi4vZW5naW5lL2NvbXBvbmVudHMvSW1hZ2VDb21wb25lbnRcIjtcbmltcG9ydCBUd2VlbiBmcm9tIFwiLi4vZW5naW5lL2NvcmUvVHdlZW5cIjtcblxuY29uc3QgZW5naW5lID0gbmV3IEVuZ2luZSgpO1xuXG5sZXQgY291bnQgPSAwO1xuXG5jb25zdCBzY2VuZUNvbXBvbmVudHMgPSBbXG4gICAgbmV3IFRleHRDb21wb25lbnQoXCJIZWxsb1wiLCB7XG4gICAgICAgIHN0eWxlOiBuZXcgVGV4dFN0eWxlKCkuc2V0Rm9udFNpemUoOCkuc2V0RmlsbFN0eWxlKCcjMDk4YWEwJykuc2V0VGV4dEFsaWduKCdjZW50ZXInKSxcbiAgICAgICAgdHJhbnNmb3JtOiBUcmFuc2Zvcm0uZnJvbVBvc2l0aW9uKDUwLCAxMCksXG4gICAgfSksXG4gICAgbmV3IFRleHRDb21wb25lbnQoYENvdW50ICR7Y291bnR9YCwge1xuICAgICAgICBzdHlsZTogbmV3IFRleHRTdHlsZSgpLnNldEZvbnRTaXplKDgpLnNldEZpbGxTdHlsZSgnIzA5OGFhMCcpLnNldFRleHRBbGlnbignY2VudGVyJyksXG4gICAgICAgIHRyYW5zZm9ybTogVHJhbnNmb3JtLmZyb21Qb3NpdGlvbig1MCwgNTApLFxuICAgICAgICB0YWc6ICdjb3VudGVyJyxcbiAgICB9KSxcbiAgICBuZXcgSW1hZ2VDb21wb25lbnQoJy4vaW1hZ2VzL2J0bi5wbmcnLCB7dHJhbnNmb3JtOiBUcmFuc2Zvcm0uY2VudGVyZWQoNTAsIDg1LCA1MCwgMTApLCB0YWc6ICdidXR0b24nfSksXG5dO1xuXG5jb25zdCBzYW1wbGVTY2VuZSA9IG5ldyBTY2VuZShzY2VuZUNvbXBvbmVudHMsIHtiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmJywgdGFnOiBcInNhbXBsZV9zY2VuZVwifSk7XG5cbm5ldyBUd2VlbihzYW1wbGVTY2VuZS5maW5kQ29tcG9uZW50QnlUYWcoJ2J1dHRvbicpLnRyYW5zZm9ybSwgJ3NjYWxlJywgMC41LCAxLCAxLjA1LCB7bG9vcDogdHJ1ZX0pLnN0YXJ0KCk7XG5cbnNhbXBsZVNjZW5lLmZpbmRDb21wb25lbnRCeVRhZygnYnV0dG9uJykuc2V0T25DbGljaygoKSA9PiB7XG4gICAgY291bnQgKz0gMTtcbiAgICBzYW1wbGVTY2VuZS5maW5kQ29tcG9uZW50QnlUYWcoJ2NvdW50ZXInKS5zZXRUZXh0KGBDb3VudCAke2NvdW50fWApO1xufSk7XG5cblxuZW5naW5lLmFkZFNjZW5lKHNhbXBsZVNjZW5lKTsiLCJpbXBvcnQgRW5naW5lIGZyb20gXCIuL0VuZ2luZVwiO1xyXG5pbXBvcnQgSWRHZW5lcmF0b3IgZnJvbSBcIi4uL3V0aWxzL0lkR2VuZXJhdG9yXCI7XHJcblxyXG5jbGFzcyBTY2VuZSB7XHJcbiAgICBjb21wb25lbnRzID0gW107XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50cywge2JhY2tncm91bmRDb2xvciA9ICcjZmZmJywgdGFnID0gJycsIHZpc2libGUgPSB0cnVlfSkge1xyXG4gICAgICAgIHRoaXMuZ3VpZCA9IElkR2VuZXJhdG9yLmd1aWQoKTtcclxuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBjb21wb25lbnRzO1xyXG4gICAgICAgIHRhZy5sZW5ndGggPT09IDAgPyB0aGlzLnRhZyA9IHRoaXMuZ3VpZCA6IHRoaXMudGFnID0gdGFnO1xyXG4gICAgICAgIEVuZ2luZS5pbnN0YW5jZS5zZXRCYWNrZ3JvdW5kQ29sb3IoYmFja2dyb3VuZENvbG9yKTtcclxuICAgICAgICB0aGlzLmlzVmlzaWJsZSA9IHZpc2libGU7XHJcbiAgICB9XHJcblxyXG4gICAgZHJhdyA9IChjdHgpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRzLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChlLnZpc2libGUpXHJcbiAgICAgICAgICAgICAgICBlLmRyYXcoY3R4KTtcclxuICAgICAgICAgICAgZS5sb29wKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGhhbmRsZUNsaWNrID0gKHgsIHkpID0+IHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNWaXNpYmxlKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgdGhpcy5jb21wb25lbnRzLmZvckVhY2goZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5vbkNsaWNrICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoeCA+PSBlLnRyYW5zZm9ybS54ICYmIHggPD0gKGUudHJhbnNmb3JtLnggKyBlLnRyYW5zZm9ybS5zaXplWCkgJiYgeSA+PSBlLnRyYW5zZm9ybS55ICYmIHkgPD0gKGUudHJhbnNmb3JtLnkgKyBlLnRyYW5zZm9ybS5zaXplWSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUub25DbGljaygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRWaXNpYmlsaXR5ID0gKHZpc2libGUpID0+IHRoaXMuaXNWaXNpYmxlID0gdmlzaWJsZTtcclxuXHJcbiAgICByZW1vdmVTY2VuZSA9ICgpID0+IG5ldyBFbmdpbmUoKS5yZW1vdmVTY2VuZSh0aGlzLnRhZyk7XHJcblxyXG4gICAgZmluZENvbXBvbmVudEJ5VGFnID0gKHRhZykgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudHMuZmluZChlID0+IGUudGFnID09PSB0YWcpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTY2VuZTtcclxuIiwiaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4uL2NvcmUvQmFzZUNvbXBvbmVudFwiO1xyXG5pbXBvcnQgVHJhbnNmb3JtIGZyb20gXCIuLi9jb3JlL1RyYW5zZm9ybVwiO1xyXG5pbXBvcnQgRWxlbWVudFByb3ZpZGVyIGZyb20gXCIuLi91dGlscy9FbGVtZW50UHJvdmlkZXJcIjtcclxuXHJcbmNsYXNzIEltYWdlQ29tcG9uZW50IGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XHJcbiAgICBjb25zdHJ1Y3RvcihpbWFnZVVybCwge3RyYW5zZm9ybSA9IFRyYW5zZm9ybS5vbmUoKSwgdGFnID0gJycsIG9uQ2xpY2t9KSB7XHJcbiAgICAgICAgc3VwZXIodGFnLCB0cmFuc2Zvcm0sIG9uQ2xpY2spO1xyXG4gICAgICAgIHRoaXMuaW1hZ2UgPSBFbGVtZW50UHJvdmlkZXIuZ2V0SW1hZ2UoaW1hZ2VVcmwpO1xyXG4gICAgfVxyXG5cclxuICAgIGRyYXcgPSAoY3R4KSA9PiB7XHJcbiAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLmltYWdlLFxyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybS54LFxyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybS55LFxyXG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybS5zaXplWCwgdGhpcy50cmFuc2Zvcm0uc2l6ZVkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldEltYWdlID0gKGltYWdlVXJsKSA9PiB7XHJcbiAgICAgICAgdGhpcy5pbWFnZSA9IEVsZW1lbnRQcm92aWRlci5nZXRJbWFnZShpbWFnZVVybCk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZGVmYXVsdCBJbWFnZUNvbXBvbmVudDtcclxuIiwiaW1wb3J0IEVuZ2luZSBmcm9tIFwiLi9FbmdpbmVcIjtcclxuXHJcbmNsYXNzIFR3ZWVuIHtcclxuXHJcbiAgICBlbGFwc2VkID0gMDtcclxuICAgIHZhbHVlID0gMDtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih0cmFuc2Zvcm0sIHR5cGUsIGR1cmF0aW9uLCBpbml0aWFsVmFsdWUsIHRhcmdldFZhbHVlLCB7bG9vcCA9IGZhbHNlfSkge1xyXG4gICAgICAgIHRoaXMudHdlZW5pbmdUcmFuc2Zvcm0gPSB0cmFuc2Zvcm07XHJcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcclxuICAgICAgICB0aGlzLmR1cmF0aW9uID0gZHVyYXRpb247XHJcbiAgICAgICAgdGhpcy5sb29wID0gbG9vcDtcclxuICAgICAgICB0aGlzLmluaXRpYWxWYWx1ZSA9IGluaXRpYWxWYWx1ZTtcclxuICAgICAgICB0aGlzLnRhcmdldFZhbHVlID0gdGFyZ2V0VmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gJ3NjYWxlJylcclxuICAgICAgICAgICAgdGhpcy50d2VlbmluZ0Z1bmN0aW9uID0gdGhpcy5zY2FsZTtcclxuICAgIH1cclxuXHJcbiAgICBzdGFydCA9ICgpID0+IHtcclxuICAgICAgICBFbmdpbmUuaW5zdGFuY2UucmVnaXN0ZXJMb29wKHRoaXMudHdlZW4pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHN0b3AgPSAoKSA9PiB7XHJcbiAgICAgICAgRW5naW5lLmluc3RhbmNlLnVucmVnaXN0ZXJMb29wKHRoaXMudHdlZW4pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHR3ZWVuID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICh0aGlzLmVsYXBzZWQgPCB0aGlzLmR1cmF0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHdlZW5pbmdGdW5jdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLmVsYXBzZWQgKz0gRW5naW5lLmluc3RhbmNlLnRpbWUuZGVsdGFUaW1lO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxvb3ApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxhcHNlZCA9IDA7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGVtcCA9IHRoaXMuaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbml0aWFsVmFsdWUgPSB0aGlzLnRhcmdldFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50YXJnZXRWYWx1ZSA9IHRlbXA7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3AoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzY2FsZSA9ICgpID0+IHtcclxuICAgICAgICBsZXQgcGVyY2VudGFnZSA9IHRoaXMuZWxhcHNlZCAvIHRoaXMuZHVyYXRpb247XHJcbiAgICAgICAgbGV0IGN1cnIgPSAoKHRoaXMudGFyZ2V0VmFsdWUgLSB0aGlzLmluaXRpYWxWYWx1ZSkgKiBwZXJjZW50YWdlKSArIHRoaXMuaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIHRoaXMudHdlZW5pbmdUcmFuc2Zvcm0uc2V0U2NhbGUoY3Vycik7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFR3ZWVuO1xyXG4iXSwic291cmNlUm9vdCI6IiJ9